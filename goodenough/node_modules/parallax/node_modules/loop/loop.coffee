periodicTimeout = (callback, element, interval) ->
  setTimeout(->
    callback((new Date).getTime() + interval)
  , interval)
 
class Loop
  constructor: (@f = (->), @interval) ->
 
  start: =>
    return if @id
 
    method = if @interval? then periodicTimeout else window.requestAnimationFrame
 
    lastCallAt = undefined
    (animLoop = () =>
      time = (new Date).getTime()
      return @stop() if @f(time, lastCallAt) is false
      lastCallAt = time
      @id =  method(animLoop, undefined, @interval)
    )()
 
    this
 
  stop: =>
    return unless @id?
 
    method = if @interval? then clearTimeout else cancelAnimationFrame
    method(@id)
 
    @id = undefined
 
    this
 
@Loop = Loop
module?.exports = @Loop